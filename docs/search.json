[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "New PuBMed publicaions including Mendelian randomi[s/z]ation in the title only",
    "section": "",
    "text": "Click to show code\nlibrary(dplyr)\nlibrary(readr)\nlibrary(lubridate)\nlibrary(tidyr)\nlibrary(ggplot2)\n\n## plot settings\ntheme_mrlit &lt;- function(...) {\n  theme_classic(base_size = 14) %+replace%\n    theme(\n      legend.position = \"bottom\",\n      strip.background = element_rect(colour = \"grey99\", fill = \"grey98\"),\n      panel.grid.major = element_line(linewidth = lwidth / 3, colour = \"grey\"),\n      panel.grid.minor = element_line(linewidth = lwidth / 5, colour = \"grey\"),\n      plot.background = element_rect(fill = NA, linewidth = lwidth / 2, colour = \"grey\"),\n      panel.border = element_rect(fill = NA, linewidth = lwidth / 2, colour = \"grey\"),\n      axis.line = element_line(linewidth = .2),\n      axis.ticks = element_line(linewidth = .2)\n    )\n}\n\n## static vars\nfpath &lt;- \".\"\nfname &lt;- \"csv-Mendelianr-set.csv\"\ncap_verb &lt;- \"Data from PubMed search for Mendelian randomi[s/z]ation, title only. \"\nxlab &lt;- \"Date\"\nylab_root &lt;- \"New PubMed Entries\"\nmycol &lt;- \"dodgerblue3\"\nlwidth &lt;- .4\noutpath &lt;- \"data\"\noutfroot &lt;- \"mrlit_pubmed\"\noutfile &lt;- paste0(outfroot, \"_\", gsub(\"-\", \"\", Sys.Date()), \".csv\")\n\n## Load data ####\nrdat &lt;- read_csv(file.path(fpath, fname))\nmax_pubmed_date &lt;- max(rdat$`Create Date`, na.rm = T)\n\ntime_levels &lt;- c(\"weeks\", \"months\", \"years\")\n\n\n## Time-wise summary ####\n\n## loop through time levels\nres &lt;- bind_rows(lapply(c(time_levels), function(z) {\n  ## assign time groups then remove record duplications from e.g. pub comments\n  dat &lt;- rdat |&gt;\n    mutate(tend = ceiling_date(`Create Date`, unit = z) - 1) |&gt;\n    group_by(Title, Authors) |&gt;\n    filter(`Create Date` == min(`Create Date`)) |&gt;\n    ungroup()\n\n  ## ensure all date rows exist even as zero.\n  agg &lt;- left_join(\n    crossing(\n      tend = seq.Date(from = min(dat$tend), to = max(dat$tend), by = paste(1, gsub(\"s$\", \"\", z)))\n    ) |&gt;\n      mutate(tend = ceiling_date(tend, unit = z) - 1),\n    dat |&gt;\n      group_by(tend) |&gt;\n      summarise(n = as.numeric(n()), .groups = \"drop\"),\n    by = join_by(tend)\n  ) |&gt;\n    mutate(n = if_else(!is.finite(n), as.numeric(0), n)) |&gt;\n    ungroup() |&gt;\n    mutate(time_level = z)\n  agg\n})) |&gt;\n  select(pubmed_date = tend, n_publications = n, time_level) |&gt;\n  mutate(cap_verb = cap_verb, file_name = fname) |&gt;\n  mutate(time_level = stringr::str_to_title(time_level)) |&gt;\n  mutate(last_pubmed_date = max_pubmed_date)\n\n## write ####\n# write_csv(res,paste0(outpath,\"/\",outfile))\n\n\n## plot ####\np &lt;- ggplot(res |&gt;\n  filter(time_level == \"Weeks\" & pubmed_date != max(pubmed_date, na.rm = F)), aes(pubmed_date, n_publications)) +\n  # geom_smooth(se=F,colour='black')+\n  geom_point(size = .25, colour = mycol, alpha = 1) +\n  geom_line(alpha = .75, colour = mycol) +\n  geom_line(data = res %&gt;% filter(time_level == \"Weeks\"), linetype = 2, alpha = .75, colour = mycol) +\n  scale_x_date(date_minor_breaks = \"1 year\") +\n  labs(\n    x = \"Date\",\n    y = paste(ylab_root, \"per week\"),\n    caption = paste(\"Most recent publication date:\", max(subset(res, time_level == \"Weeks\")$pubmed_date)),\n    x = \"Date\"\n  ) +\n  theme_mrlit()\np"
  }
]